<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="水的一匹Lu的Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://luarence.github.io//img/home-bg-jeep.jpg">
    <meta property="twitter:image" content="https://luarence.github.io//img/home-bg-jeep.jpg" />
    

    
    <meta name="title" content="[JSOI2008]星球大战--并查集" />
    <meta property="og:title" content="[JSOI2008]星球大战--并查集" />
    <meta property="twitter:title" content="[JSOI2008]星球大战--并查集" />
    

    
    <meta name="description" content="Lu Yuxi，在校本科生，喜欢技术和旅行 | 这里是 Lu Yuxi 的博客，与你一起发现更大的世界。">
    <meta property="og:description" content="Lu Yuxi，在校本科生，喜欢技术和旅行 | 这里是 Lu Yuxi 的博客，与你一起发现更大的世界。" />
    <meta property="twitter:description" content="Lu Yuxi，在校本科生，喜欢技术和旅行 | 这里是 Lu Yuxi 的博客，与你一起发现更大的世界。" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="陆 YX, luyuxi, Lu Yuxi, , 水的一匹Lu的Blog, , 博客, 个人网站, 互联网, Web, Java">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>[JSOI2008]星球大战--并查集-</title>

    <link rel="canonical" href="/post/eassy09/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>
	
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">水的一匹Lu的Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
		    
                        <li><a href="/top/books/">BOOKS</a></li>
                    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
		    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-bg-jeep.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/acm" title="ACM">
                            ACM
                        </a>
                        
                    </div>
                    <h1>[JSOI2008]星球大战--并查集</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
			Posted by 
			
		            水的一匹Lu的Blog
			 
			on 
			Tuesday, September 17, 2019
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#题目描述">题目描述</a></li>
<li><a href="#输入格式">输入格式</a></li>
<li><a href="#输出格式">输出格式</a></li>
<li><a href="#输入输出样例">输入输出样例</a></li>
<li><a href="#题目大意">题目大意</a></li>
<li><a href="#题目分析">题目分析</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
                
                

<p><strong>前言：</strong>做了两道关于并查集的省选题，本想整一个并查集专题把这两道题目一块整理出来，但这道题我在做的过程中四处碰壁，TLE、MLE、WA、RE$\cdots$ 这些能报的错我基本上都报了一遍，用到很多之前博客里写过的内容，最终历尽万苦才AC了；所以这让我决定把这道题目单独拿出来写一篇文章。</p>

<hr />

<p><strong>话不多说先上题目：</strong>（本题来自江苏省省选，题目内容摘自洛谷）</p>

<h3 id="题目描述">题目描述</h3>

<blockquote>
<p>很久以前，在一个遥远的星系，一个黑暗的帝国靠着它的超级武器统治着整个星系。某一天，凭着一个偶然的机遇，一支反抗军摧毁了帝国的超级武器，并攻下了星系中几乎所有的星球。这些星球通过特殊的以太隧道互相直接或间接地连接。但好景不长，很快帝国又重新造出了他的超级武器。凭借这超级武器的力量，帝国开始有计划地摧毁反抗军占领的星球。由于星球的不断被摧毁，两个星球之间的通讯通道也开始不可靠起来。现在，反抗军首领交给你一个任务：给出原来两个星球之间的以太隧道连通情况以及帝国打击的星球顺序，以尽量快的速度求出每一次打击之后反抗军占据的星球的连通块的个数。（如果两个星球可以通过现存的以太通道直接或间接地连通，则这两个星球在同一个连通块中）。</p>
</blockquote>

<h3 id="输入格式">输入格式</h3>

<blockquote>
<p>输入文件第一行包含两个整数，N (1&lt;=N&lt;=2M，1 &lt; = N &lt; = 2M，1&lt;=N&lt;=2M) 和 M (1&lt;=M&lt;=200,000，1 &lt; = M &lt; = 200,0001&lt;=M&lt;=200,000)，分别表示星球的数目和以太隧道的数目。星球用 0 ~ N−1 的整数编号。接下来的 M 行，每行包括两个整数 X, Y，其中（0&lt;=X&lt;&gt;Y)表示星球 x和星球 y 之间有 “以太” 隧道，可以直接通讯。接下来的一行为一个整数 kkk ，表示将遭受攻击的星球的数目。接下来的 k 行，每行有一个整数，按照顺序列出了帝国军的攻击目标。这 k 个数互不相同，且都在 0 到 n−1的范围内。</p>
</blockquote>

<h3 id="输出格式">输出格式</h3>

<blockquote>
<p>第一行是开始时星球的连通块个数。接下来的 K 行，每行一个整数，表示经过该次打击后现存星球的连通块个数。</p>
</blockquote>

<h3 id="输入输出样例">输入输出样例</h3>

<p><strong>输入 #1</strong></p>

<pre><code>8 13
0 1
1 6
6 5
5 0
0 6
1 2
2 3
3 4
4 5
7 1
7 2
7 6
3 6
5
1
6
3
5
7

</code></pre>

<p><strong>输出 #1</strong></p>

<pre><code>1
1
1
2
3
3
</code></pre>

<h3 id="题目大意">题目大意</h3>

<p>原先所有星球都是根据数据中所给的路连在一起的，现在要开始摧毁星球，摧毁星球的同时，与这些被摧毁星球相关的路也不复存在，现在题目就是让求每次摧毁星球后剩下联通块的个数。</p>

<h3 id="题目分析">题目分析</h3>

<p>读完这道题可以肯定一个事情&mdash;这道题目可以用并查集来解决，关键是怎样解决呢？我首先想到的就是暴力，先把路都连起来，然后每摧毁一个星球，用并查集求一次联通块，很显然一道省选题目不可能让我这么简单就做出来，这种思路是不对的。正着不行，可以反着来，把<strong>摧毁</strong>想成<strong>修复</strong>，先把打击后的联通块数量求出来，然后再倒着修复被摧毁的点，每修复一个点把修复完成后的联通块数量记录在数组里，最后输出这个数组就好了。</p>

<hr />

<p>于是就有了我第一次提交的代码，很不幸TLE了，但是我还是要把它贴上来，因为它的思路是对的，而且比较好理解</p>

<p><strong>TLE代码：</strong></p>

<pre><code class="language-java">import java.io.*;
import java.util.ArrayList;
import java.util.List;

public class LG_1197_TLE {
    public static int find(int[] parent,int x){
        int r = x;
        while (parent[r] != -1) {
            r = parent[r];
        }
        int j = x,i;
        while (j != r) {
            i = parent[j];
            parent[j] = r;
            j = i;

        }
        return r;
    }
    public static void union(int[] parent,int x,int y){
        int fx = find(parent,x);
        int fy = find(parent,y);

        if (fx != fy) {
            parent[fx] = fy;
        }
    }
    public static void main(String[] args) throws IOException {
        StreamTokenizer in = new StreamTokenizer(new BufferedReader(new InputStreamReader(System.in)));
        PrintWriter out = new PrintWriter(new OutputStreamWriter(System.out));

        while (in.nextToken() != StreamTokenizer.TT_EOF) {
            int N = (int)in.nval;
            in.nextToken();
            int M = (int)in.nval;
            int[] parent = new int[N];

            for (int i = 0; i &lt; N; i++) {
                parent[i] = -1;
            }

            //记录是否被摧毁数组
            int[] ifdes = new int[N];
            //存储星球信息
            List&lt;Star&gt; stars = new ArrayList&lt;&gt;();

            for (int i = 0; i &lt; M; i++) {
                in.nextToken();
                int x = (int)in.nval;
                in.nextToken();
                int y = (int)in.nval;
//                union(parent,x,y);
                stars.add(new Star(x,y,i));
            }

            in.nextToken();
            int k = (int)in.nval;
            //要摧毁星球数组
            int[] destroy = new int[k];
            //记住编号
            int[] ans = new int[k+1];

            for (int i = 0; i &lt; k; i++) {
                in.nextToken();
                int des = (int)in.nval;
                //标记会被摧毁
                ifdes[des] = -1;
                destroy[i] = des;
            }
            //打击后剩下的点
            int total = N-k;
            //先连不会被摧毁的星球
            for(Star star:stars){
                int from = star.from;
                int to = star.to;
                if (ifdes[from] != -1 &amp;&amp; ifdes[to] != -1) {
                    //证明没有被摧毁
                    int fx = find(parent,from);
                    int fy = find(parent,to);
                    if (fx != fy) {
                        total--;
                        parent[fx] = fy;
                    }
                }
            }
            ans[k] = total;
            //开始逆序
            for (int i = k-1; i &gt;= 0; i--) {
                int des = destroy[i];
                total++;
                ifdes[des] = 0;

                //遍历所有与他有关的点（TLE）
                for (Star star:stars){
                    int from = star.from;
                    int to = star.to;
                    if (from == des) {
                        if (ifdes[to] != -1){
                            int fx = find(parent,des);
                            int fy = find(parent,to);
                            if (fx != fy) {
                                total--;
                                parent[fx] = fy;
                            }
                        }
                    } else if (to == des) {
                        if (ifdes[from] != -1) {
                            int fx = find(parent,des);
                            int fy = find(parent,from);
                            if (fx != fy) {
                                total--;
                                parent[fx] = fy;
                            }
                        }
                    }
                }
                ans[i] = total;
            }
            for (int i = 0; i &lt;= k; i++) {
                out.println(ans[i]);
            }
            out.flush();

        }
    }
}
class Star implements Comparable&lt;Star&gt;{
    int from;
    int to;
    //摧毁的顺序
    int index;

    public Star(int from, int to, int index) {
        this.from = from;
        this.to = to;
        this.index = index;
    }

    @Override
    public int compareTo(Star o) {
        return new Integer(this.index).compareTo(o.index);
    }
}

</code></pre>

<p>这个思路是对的,但是修复星球时，每次都要把所有数据遍历一遍找与这个星球相关的点，这可能就是造成超时的原因。后来知道了可以用邻接矩阵或邻接表来做，才算是恍然大悟。</p>

<p><strong>AC代码：</strong></p>

<pre><code class="language-java">import java.io.*;
import java.util.Scanner;

public class LG_1197 {
    //邻接矩阵
    static int[] h;
    static int[] to;
    static int[] pre;
    static int[] next;
    static int top = -1;
    public static int[] parent;
    public static int find(int x){
        int r = x;
        while (parent[r] != -1) {
            r = parent[r];
        }
        int j = x,i;
        while (j != r) {
            i = parent[j];
            parent[j] = r;
            j = i;
        }
        return r;
    }

    public static void union(int x,int y){
        pre[++top] = x;
        next[top] = h[x];
        to[top] = y;
        h[x] = top;
    }
    
//这道题Java可能必须用到输入输出优化，否则方法对了也会报TLE
    public static void main(String[] args) throws IOException {
        StreamTokenizer in = new StreamTokenizer(new BufferedReader(new InputStreamReader(System.in)));
        PrintWriter out = new PrintWriter(new OutputStreamWriter(System.out));

        while (in.nextToken() != StreamTokenizer.TT_EOF) {
            int N = (int)in.nval;
            in.nextToken();
            int M = (int)in.nval;
            parent = new int[N];
            pre = new int[M*2+1];
            to = new int[M*2+1];
            next = new int[M*2+1];
            h = new int[N*2+1];
            for (int i = 0; i &lt; N; i++) {
                h[i] = -1;
                parent[i] = -1;
            }

            //记录是否被摧毁数组
            int[] ifdes = new int[N];
            //存储星球信息
            for (int i = 1; i &lt;= M; i++) {
                in.nextToken();
                int x = (int)in.nval;
                in.nextToken();
                int y = (int)in.nval;
//                stars.add(new Star(x,y,i));
                union(x,y);
                union(y,x);
            }
            in.nextToken();
            int k = (int)in.nval;
            //要摧毁星球数组
            int[] destroy = new int[k];
            //记住编号
            int[] ans = new int[k+1];

            for (int i = 0; i &lt; k; i++) {
                in.nextToken();
                int des = (int)in.nval;
                //标记会被摧毁
                ifdes[des] = -1;
                destroy[i] = des;
            }
            //打击后剩下的点
            int total = N-k;
            for (int i = 0; i &lt; 2*M; i++) {
                if (ifdes[pre[i]] != -1 &amp;&amp; ifdes[to[i]] != -1) {
                    int find_x = find(pre[i]);
                    int find_y = find(to[i]);
                    if (find_x != find_y) {
                        total--;
                        parent[find_x] = find_y;
                    }
                }
            }
            ans[k] = total;
            //开始逆序
            for (int i = k-1; i &gt;= 0; i--) {
                int des = destroy[i];
                total++;
                ifdes[des] = 0;
                //遍历所有与他有关的点
                for (int j = h[des];j!=-1;j=next[j]) {
                    if (ifdes[to[j]] == -1) {
                        continue;
                    }else {
                        int fx = find(des);
                        int fy = find(to[j]);
                        if (fx != fy) {
                            total--;
                            parent[fx] = fy;
                        }
                    }
                }
                ans[i] = total;
            }
            for (int i = 0; i &lt;= k; i++) {
                out.println(ans[i]);
            }
            out.flush();
        }
    }
}
</code></pre>


                
                
<div class="entry-shang text-center">
    
	    <p>「真诚赞赏，手留余香」</p>
	
	<button class="zs show-zs btn btn-bred">赞赏支持</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">×</button>
		<span class="author"><a href="https://luarence.github.io/"><img src="/img/favicon.png" />水的一匹Lu的Blog</a></span>
        
	        <p class="tip"><i></i><span>真诚赞赏，手留余香</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2元</button>
			<button class="btn btn-blink" data-num="5">5元</button>
			<button class="btn btn-blink" data-num="10">10元</button>
			<button class="btn btn-blink" data-num="50">50元</button>
			<button class="btn btn-blink" data-num="100">100元</button>
			<button class="btn btn-blink" data-num="1">任意金额</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2元</button>
			<p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/eassy08/" data-toggle="tooltip" data-placement="top" title="Java的输入输出优化-StreamTokenizer">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/acm" title="acm">
                            acm
                        </a>
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="#">暂无</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="水的一匹Lu的Blog" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:l719536781@163.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="/your%20wechat%20qr%20code%20image">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://github.com/luarence">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/yourlinkedinid">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 水的一匹Lu的Blog 2019
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
